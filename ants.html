<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ants</title>
</head>
<script src="lib/modernizr-1.6.min.js"></script>
<script src="src/SpaceManager.js"></script>
<script src="src/Dudes.js"></script>
<body>
  <canvas id="antsCanvas" 
          width="800" height="500" 
          style="border: 1px solid black;">
    We roll HTML5-style up in here, please be advised
  </canvas>
  <form>
    <div>
      <label for="dudeCount"
	     >How Many</label>
      <input type="text" id="dudeCount" value="500">
    </div>
    <div>
      <label for="dudeStrategy"
	     >How Should they Make Decisions?</label>
      <textarea id="dudeStrategy">
    // dude - this is the dude you can move or change
    // neighbors - an array of other dudes "near" your dude
    // ticks - the time, in abstract "ticks"
    var curve = (2.0 * Math.PI)/20;
    dude.heading = dude.heading + curve;
      </textarea>
    </div>
  </form>
<script>
window.onload = function() {
    var canvas = document.getElementById("antsCanvas");
    var gfx = canvas.getContext("2d");
    var ticks = 0;
    
    var dudeCount = null;
    var dudeStrategyTxt = "";

    // We fudge the boundaries a bit to
    // stop 
    var dudes = new Dudes(gfx, 
			  -20 , canvas.width,
			  -20, canvas.height,
			  -20, (function() {}));

    var checkForm = function() {
	var newCountTxt =
	    document.getElementById("dudeCount").value;
	var newStrategyTxt =
	    document.getElementById("dudeStrategy").value;

	var newCount = parseInt(newCountTxt, 10);

	if((newCount != dudeCount) ||
	   (newStrategyTxt != dudeStrategyTxt)) {

	    var newStrategy = 
		new Function("dude", "neighbors", "bounds", "ticks", 
			     newStrategyTxt);

	    dudes = new Dudes(gfx, 
			      -20, canvas.width,
			      -20, canvas.height,
			      newCount, newStrategy);

	    dudeCount = newCount;
	    dudeStrategyTxt = newStrategyTxt;
	}	    
    };

    var animation = setInterval(function() {	
	ticks++;

	if(!(ticks % 10)) {
	    checkForm();
	}

	dudes.update(ticks);
    }, 100);
};
</script>
</body>
</html>
